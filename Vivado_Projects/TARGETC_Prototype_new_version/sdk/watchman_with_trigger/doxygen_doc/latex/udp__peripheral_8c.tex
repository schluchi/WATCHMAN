\section{C\+:/\+Users/antho/\+Documents/\+W\+A\+T\+C\+H\+M\+A\+N/\+Vivado\+\_\+\+Projects/\+T\+A\+R\+G\+E\+T\+C\+\_\+\+Prototype\+\_\+new\+\_\+version/sdk/watchman\+\_\+with\+\_\+trigger/src/udp\+\_\+peripheral.c File Reference}
\label{udp__peripheral_8c}\index{C:/Users/antho/Documents/WATCHMAN/Vivado\_Projects/TARGETC\_Prototype\_new\_version/sdk/watchman\_with\_trigger/src/udp\_peripheral.c@{C:/Users/antho/Documents/WATCHMAN/Vivado\_Projects/TARGETC\_Prototype\_new\_version/sdk/watchman\_with\_trigger/src/udp\_peripheral.c}}
{\ttfamily \#include \char`\"{}udp\+\_\+peripheral.\+h\char`\"{}}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
err\+\_\+t \textbf{ transfer\+\_\+data} (char $\ast$frame, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Send a frame trought U\+DP. \end{DoxyCompactList}\item 
err\+\_\+t \textbf{ transfer\+\_\+cmd} (char $\ast$frame, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Send a frame trought U\+DP. \end{DoxyCompactList}\item 
void \textbf{ udp\+\_\+cmd\+\_\+recv} (void $\ast$arg, struct udp\+\_\+pcb $\ast$pcb, struct pbuf $\ast$p, const ip\+\_\+addr\+\_\+t $\ast$addr, u16\+\_\+t port)
\begin{DoxyCompactList}\small\item\em callback when a command is received \end{DoxyCompactList}\item 
int \textbf{ command\+\_\+parser} (struct pbuf $\ast$p, char $\ast$return\+\_\+buf)
\begin{DoxyCompactList}\small\item\em Process the data received and report a command. \end{DoxyCompactList}\item 
int \textbf{ setup\+\_\+udp\+\_\+settings} (ip\+\_\+addr\+\_\+t pc\+\_\+ipaddr)
\begin{DoxyCompactList}\small\item\em Setup all the settings for the U\+DP communication (data and command) \end{DoxyCompactList}\item 
int \textbf{ setup\+\_\+pcb\+\_\+data} (ip\+\_\+addr\+\_\+t pc\+\_\+ipaddr, uint16\+\_\+t port)
\begin{DoxyCompactList}\small\item\em Setup the U\+DP Protocol Control Block for the data frame. \end{DoxyCompactList}\item 
int \textbf{ setup\+\_\+pcb\+\_\+cmd} (ip\+\_\+addr\+\_\+t pc\+\_\+ipaddr, uint16\+\_\+t port)
\begin{DoxyCompactList}\small\item\em Setup the U\+DP Protocol Control Block for the command frame. \end{DoxyCompactList}\item 
void \textbf{ cleanup\+\_\+udp} (void)
\begin{DoxyCompactList}\small\item\em Disable and clean the U\+DP P\+CB for the data and the command. \end{DoxyCompactList}\item 
void \textbf{ print\+\_\+ip} (char $\ast$msg, ip\+\_\+addr\+\_\+t $\ast$ip)
\begin{DoxyCompactList}\small\item\em Function to print an IP address with a message (used in debug mostly) \end{DoxyCompactList}\item 
void \textbf{ print\+\_\+ip\+\_\+settings} (ip\+\_\+addr\+\_\+t $\ast$ip, ip\+\_\+addr\+\_\+t $\ast$mask, ip\+\_\+addr\+\_\+t $\ast$gw)
\begin{DoxyCompactList}\small\item\em Function to print all the settings of an Internet connection (used in debug mostly) \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\label{udp__peripheral_8c_ad82e4dd5f2bdcc51b68d9ecf90b6fe86}} 
struct udp\+\_\+pcb $\ast$ {\bfseries pcb\+\_\+data}
\item 
\mbox{\label{udp__peripheral_8c_aa3d0cb57350fe30a5927092475c0faa2}} 
struct udp\+\_\+pcb $\ast$ {\bfseries pcb\+\_\+cmd}
\item 
\mbox{\label{udp__peripheral_8c_a1fe64ecef353657c532741807aa947ca}} 
struct pbuf $\ast$ {\bfseries buf\+\_\+data}
\item 
\mbox{\label{udp__peripheral_8c_ae28b199c6f079cd3546d2263812f69e3}} 
struct pbuf $\ast$ {\bfseries buf\+\_\+cmd}
\item 
\mbox{\label{udp__peripheral_8c_a3d99f75279bc0e1ed6ae24ad1f92b3fb}} 
volatile int {\bfseries count\+\_\+ttcps\+\_\+timer}
\item 
\mbox{\label{udp__peripheral_8c_a6f03c2bee8cf4ef8c4319f1f60561ad1}} 
volatile int {\bfseries count\+\_\+scu\+\_\+timer}
\item 
\mbox{\label{udp__peripheral_8c_a5655744cbf3859b8d3279d4a3a22ce90}} 
int {\bfseries nbre\+\_\+of\+\_\+bytes}
\item 
\mbox{\label{udp__peripheral_8c_a4d1709746b2e7d35d9bef7ee11f2c790}} 
volatile bool {\bfseries run\+\_\+flag}
\item 
\mbox{\label{udp__peripheral_8c_ac285664a88629c304befd42daafc3f90}} 
volatile bool {\bfseries stream\+\_\+flag}
\item 
\mbox{\label{udp__peripheral_8c_af98df565a37a3db3fcafb5e66e062316}} 
volatile bool {\bfseries get\+\_\+transfer\+\_\+fct\+\_\+flag}
\item 
\mbox{\label{udp__peripheral_8c_ac3a118de77182fc96c16057fb7f75ec1}} 
volatile bool {\bfseries get\+\_\+20\+\_\+windows\+\_\+flag}
\item 
\mbox{\label{udp__peripheral_8c_a39d2cad95814eb9635cca5310d914893}} 
int $\ast$ {\bfseries regptr}
\item 
\mbox{\label{udp__peripheral_8c_a1a1226656ce6fe65b369f5516caeb17a}} 
char $\ast$ {\bfseries frame\+\_\+buf\+\_\+cmd}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyAuthor}{Author}
Anthony Schluchin 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
24th October 2018 
\end{DoxyDate}
\begin{DoxyVersion}{Version}
0.\+0 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\label{udp__peripheral_8c_ad88f9f0378dd06c17528eb9f203c2467}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!cleanup\_udp@{cleanup\_udp}}
\index{cleanup\_udp@{cleanup\_udp}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{cleanup\_udp()}
{\footnotesize\ttfamily void cleanup\+\_\+udp (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Disable and clean the U\+DP P\+CB for the data and the command. 


\begin{DoxyParams}{Parameters}
{\em None} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_a4f92cb22c72184c5a93a83fb85490c24}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!command\_parser@{command\_parser}}
\index{command\_parser@{command\_parser}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{command\_parser()}
{\footnotesize\ttfamily int command\+\_\+parser (\begin{DoxyParamCaption}\item[{struct pbuf $\ast$}]{p,  }\item[{char $\ast$}]{return\+\_\+buf }\end{DoxyParamCaption})}



Process the data received and report a command. 


\begin{DoxyParams}{Parameters}
{\em p} & pointer to the buffer containing the data received \\
\hline
{\em return\+\_\+buf} & pointer to the data to be echoed back\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1 if there is a problem or the number of byte in return\+\_\+bf
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_acf75bb5ef6105dd155ddc36f84a71606}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!print\_ip@{print\_ip}}
\index{print\_ip@{print\_ip}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{print\_ip()}
{\footnotesize\ttfamily void print\+\_\+ip (\begin{DoxyParamCaption}\item[{char $\ast$}]{msg,  }\item[{ip\+\_\+addr\+\_\+t $\ast$}]{ip }\end{DoxyParamCaption})}



Function to print an IP address with a message (used in debug mostly) 


\begin{DoxyParams}{Parameters}
{\em msg} & pointer to the message to print before the IP address \\
\hline
{\em ip} & pointer to the IP address to print\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_a267907eb6db3b11649fd717d308572fb}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!print\_ip\_settings@{print\_ip\_settings}}
\index{print\_ip\_settings@{print\_ip\_settings}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{print\_ip\_settings()}
{\footnotesize\ttfamily void print\+\_\+ip\+\_\+settings (\begin{DoxyParamCaption}\item[{ip\+\_\+addr\+\_\+t $\ast$}]{ip,  }\item[{ip\+\_\+addr\+\_\+t $\ast$}]{mask,  }\item[{ip\+\_\+addr\+\_\+t $\ast$}]{gw }\end{DoxyParamCaption})}



Function to print all the settings of an Internet connection (used in debug mostly) 


\begin{DoxyParams}{Parameters}
{\em ip} & pointer to the IP address to print \\
\hline
{\em mask} & pointer to the mask to print \\
\hline
{\em gw} & pointer to the gateway to print\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_accb1397832cf5c4f1b960e425b00db17}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!setup\_pcb\_cmd@{setup\_pcb\_cmd}}
\index{setup\_pcb\_cmd@{setup\_pcb\_cmd}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{setup\_pcb\_cmd()}
{\footnotesize\ttfamily int setup\+\_\+pcb\+\_\+cmd (\begin{DoxyParamCaption}\item[{ip\+\_\+addr\+\_\+t}]{pc\+\_\+ipaddr,  }\item[{uint16\+\_\+t}]{port }\end{DoxyParamCaption})}



Setup the U\+DP Protocol Control Block for the command frame. 


\begin{DoxyParams}{Parameters}
{\em pc\+\_\+ipaddr} & IP address of the computer \\
\hline
{\em port} & U\+DP port of the computer used for the command\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if ok, negative values if there is a problem
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_a4107e96522a377bc24430731773ee4d9}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!setup\_pcb\_data@{setup\_pcb\_data}}
\index{setup\_pcb\_data@{setup\_pcb\_data}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{setup\_pcb\_data()}
{\footnotesize\ttfamily int setup\+\_\+pcb\+\_\+data (\begin{DoxyParamCaption}\item[{ip\+\_\+addr\+\_\+t}]{pc\+\_\+ipaddr,  }\item[{uint16\+\_\+t}]{port }\end{DoxyParamCaption})}



Setup the U\+DP Protocol Control Block for the data frame. 


\begin{DoxyParams}{Parameters}
{\em pc\+\_\+ipaddr} & IP address of the computer \\
\hline
{\em port} & U\+DP port of the computer used for the data\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if ok, negative values if there is a problem
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_add95cc1d5556c34f8c40639de2b37057}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!setup\_udp\_settings@{setup\_udp\_settings}}
\index{setup\_udp\_settings@{setup\_udp\_settings}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{setup\_udp\_settings()}
{\footnotesize\ttfamily int setup\+\_\+udp\+\_\+settings (\begin{DoxyParamCaption}\item[{ip\+\_\+addr\+\_\+t}]{pc\+\_\+ipaddr }\end{DoxyParamCaption})}



Setup all the settings for the U\+DP communication (data and command) 


\begin{DoxyParams}{Parameters}
{\em pc\+\_\+ipaddr} & IP address of the computer\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if ok, negative values if there is a problem
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_a4adcaacf2585294540f0c7bcad70d11f}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!transfer\_cmd@{transfer\_cmd}}
\index{transfer\_cmd@{transfer\_cmd}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{transfer\_cmd()}
{\footnotesize\ttfamily err\+\_\+t transfer\+\_\+cmd (\begin{DoxyParamCaption}\item[{char $\ast$}]{frame,  }\item[{uint16\+\_\+t}]{length }\end{DoxyParamCaption})}



Send a frame trought U\+DP. 


\begin{DoxyParams}{Parameters}
{\em frame} & pointer to the frame to send \\
\hline
{\em length} & size of the frame\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
type err\+\_\+enum\+\_\+t\+: enumaration from err.\+h file
\end{DoxyReturn}
\begin{DoxyNote}{Note}
frame must take in consideration the header ex\+: for a buffer of size 6 char$\ast$ test\+\_\+array = (char $\ast$)malloc(6 + B\+U\+F\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+ZE); and then transfer\+\_\+data(\&test\+\_\+array[\+B\+U\+F\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E], 6) 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_afc63b6b60c2621e2e57dc85d49adf824}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!transfer\_data@{transfer\_data}}
\index{transfer\_data@{transfer\_data}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{transfer\_data()}
{\footnotesize\ttfamily err\+\_\+t transfer\+\_\+data (\begin{DoxyParamCaption}\item[{char $\ast$}]{frame,  }\item[{uint16\+\_\+t}]{length }\end{DoxyParamCaption})}



Send a frame trought U\+DP. 


\begin{DoxyParams}{Parameters}
{\em frame} & pointer to the frame to send \\
\hline
{\em length} & size of the frame\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
type err\+\_\+enum\+\_\+t\+: enumaration from err.\+h file
\end{DoxyReturn}
\begin{DoxyNote}{Note}
frame must take in consideration the header ex\+: for a buffer of size 6 char$\ast$ test\+\_\+array = (char $\ast$)malloc(6 + B\+U\+F\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+ZE); and then transfer\+\_\+data(\&test\+\_\+array[\+B\+U\+F\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E], 6) 
\end{DoxyNote}
\mbox{\label{udp__peripheral_8c_a02046b4aed2b022cd328eacfcf3b048d}} 
\index{udp\_peripheral.c@{udp\_peripheral.c}!udp\_cmd\_recv@{udp\_cmd\_recv}}
\index{udp\_cmd\_recv@{udp\_cmd\_recv}!udp\_peripheral.c@{udp\_peripheral.c}}
\subsubsection{udp\_cmd\_recv()}
{\footnotesize\ttfamily void udp\+\_\+cmd\+\_\+recv (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg,  }\item[{struct udp\+\_\+pcb $\ast$}]{pcb,  }\item[{struct pbuf $\ast$}]{p,  }\item[{const ip\+\_\+addr\+\_\+t $\ast$}]{addr,  }\item[{u16\+\_\+t}]{port }\end{DoxyParamCaption})}



callback when a command is received 


\begin{DoxyParams}{Parameters}
{\em arg} & not used \\
\hline
{\em pcb} & U\+DP Protocol Control Block used to send the data. \\
\hline
{\em p} & pointer to the buffer containing the data received \\
\hline
{\em addr} & IP address of the destination \\
\hline
{\em port} & U\+DP port of the destination\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
None
\end{DoxyReturn}
\begin{DoxyNote}{Note}
-\/ 
\end{DoxyNote}
